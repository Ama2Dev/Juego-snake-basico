<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Culebrita ‚Äî HTML, CSS y JS</title>
  <style>
    :root {
      --bg: #0f1226;
      --panel: #15193a;
      --accent: #49de80;
      --accent-dark: #3ac36b;
      --food: #ff5d5d;
      --grid: #222751;
      --text: #e8ecf1;
      --muted: #94a3b8;
      --warning: #ffd166;
      --danger: #ff5d5d;
      --tile-size: 20px;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 70% -10%, #18204a 0%, #0f1226 40%, #0b0e20 100%);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .wrap {
      width: 100%;
      max-width: 520px;
      display: grid;
      gap: 12px;
    }

    .header {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
    }

    .title {
      font-weight: 700;
      letter-spacing: 0.3px;
      font-size: 1.05rem;
      color: var(--text);
    }

    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    button {
      background: var(--panel);
      border: 1px solid #2a3163;
      color: var(--text);
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.05s ease, background 0.2s ease, border-color 0.2s ease;
      font-weight: 600;
    }
    button:hover { background: #1a1f44; border-color: #3a4386; }
    button:active { transform: translateY(1px) scale(0.99); }
    button.primary { background: linear-gradient(180deg, var(--accent), var(--accent-dark)); border-color: transparent; color: #082010; }
    button.warn { background: #2a2030; border-color: #55304a; color: #ffd9e1; }

    .info {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .card {
      background: var(--panel);
      border: 1px solid #2a3163;
      padding: 10px 12px;
      border-radius: 12px;
      display: grid;
      gap: 2px;
    }
    .card .label { color: var(--muted); font-size: 0.75rem; }
    .card .value { font-weight: 800; font-size: 1.1rem; letter-spacing: 0.4px; }

    .board {
      position: relative;
      background: #0b0f2d;
      border: 2px solid #29306b;
      border-radius: 14px;
      padding: 12px;
    }

    canvas {
      display: block;
      width: 100%;
      height: auto;
      image-rendering: pixelated;
      background:
        linear-gradient(#0d1240, #0d1240) padding-box,
        repeating-linear-gradient(0deg, transparent, transparent 19px, var(--grid) 19px, var(--grid) 20px),
        repeating-linear-gradient(90deg, transparent, transparent 19px, var(--grid) 19px, var(--grid) 20px);
      border-radius: 10px;
    }

    .overlay {
      position: absolute;
      inset: 12px;
      border-radius: 10px;
      display: grid;
      place-items: center;
      background: rgba(10, 13, 32, 0.4);
      backdrop-filter: blur(2px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }
    .overlay.show { opacity: 1; pointer-events: auto; }

    .overlay .panel {
      background: rgba(14, 18, 45, 0.9);
      border: 1px solid #2a3163;
      padding: 16px 18px;
      border-radius: 12px;
      text-align: center;
      max-width: 280px;
      display: grid;
      gap: 10px;
    }
    .panel .big {
      font-weight: 800;
      font-size: 1.3rem;
      letter-spacing: 0.5px;
    }
    .panel .small { color: var(--muted); font-size: 0.85rem; }

    /* Controles t√°ctiles */
    .touch {
      margin-top: 8px;
      display: grid;
      grid-template-areas:
        ". up ."
        "left center right"
        ". down .";
      gap: 8px;
      justify-content: center;
      align-content: center;
      user-select: none;
    }
    .touch button {
      width: 64px;
      height: 48px;
      border-radius: 12px;
      font-weight: 800;
      letter-spacing: 0.5px;
      background: #15193a;
      border: 1px solid #2a3163;
      color: #c7d2fe;
    }
    .touch .up    { grid-area: up; }
    .touch .down  { grid-area: down; }
    .touch .left  { grid-area: left; }
    .touch .right { grid-area: right; }
    .touch .center{ grid-area: center; visibility: hidden; }

    @media (max-width: 480px) {
      .info { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">üêç Culebrita ‚Äî JavaScript</div>
      <div class="controls">
        <button id="btn-start" class="primary">Iniciar / Pausar</button>
        <button id="btn-reset" class="warn">Reiniciar</button>
      </div>
    </div>

    <div class="info">
      <div class="card">
        <div class="label">Puntuaci√≥n</div>
        <div class="value" id="score">0</div>
      </div>
      <div class="card">
        <div class="label">Mejor</div>
        <div class="value" id="best">0</div>
      </div>
      <div class="card">
        <div class="label">Velocidad</div>
        <div class="value"><span id="speed">1.0</span>x</div>
      </div>
    </div>

    <div class="board">
      <canvas id="game" width="400" height="400" aria-label="Tablero de juego"></canvas>

      <div id="overlay" class="overlay">
        <div class="panel">
          <div id="status" class="big">Pausa</div>
          <div id="hint" class="small">Presiona Iniciar o barra espaciadora</div>
          <button id="btn-resume" class="primary">Continuar</button>
        </div>
      </div>
    </div>

    <div class="touch" aria-hidden="false">
      <button class="up"    data-dir="up">‚ñ≤</button>
      <button class="left"  data-dir="left">‚óÄ</button>
      <button class="center" disabled>‚Ä¢</button>
      <button class="right" data-dir="right">‚ñ∂</button>
      <button class="down"  data-dir="down">‚ñº</button>
    </div>
  </div>

  <script>
    // ===== Configuraci√≥n del juego =====
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const TILE = 20;                  // tama√±o de cada celda en px (400/20 = 20x20 celdas)
    const COLS = canvas.width / TILE; // 20
    const ROWS = canvas.height / TILE;// 20
    const BASE_INTERVAL = 140;        // ms (se acelera seg√∫n puntaje)
    const MIN_INTERVAL = 70;          // ms
    const SPEED_STEP = 5;             // acelera cada 5 puntos

    // UI
    const scoreEl = document.getElementById('score');
    const bestEl  = document.getElementById('best');
    const speedEl = document.getElementById('speed');
    const overlay = document.getElementById('overlay');
    const statusEl= document.getElementById('status');
    const hintEl  = document.getElementById('hint');
    const btnStart= document.getElementById('btn-start');
    const btnReset= document.getElementById('btn-reset');
    const btnResume=document.getElementById('btn-resume');

    // Estado
    let snake, dir, nextDir, food, score, best, timerId, interval, running, dead;

    function resetGame() {
      snake = [
        { x: 8, y: 10 },
        { x: 7, y: 10 },
        { x: 6, y: 10 },
      ];
      dir = { x: 1, y: 0 };
      nextDir = { x: 1, y: 0 };
      score = 0;
      dead = false;
      placeFood();
      updateUI();
      setSpeedFromScore();
      draw();
      showOverlay(true, 'Pausa', 'Presiona Iniciar o barra espaciadora');
      running = false;
      stopLoop();
    }

    function updateUI() {
      scoreEl.textContent = score;
      const speedFactor = (BASE_INTERVAL / interval).toFixed(1);
      speedEl.textContent = speedFactor;
      bestEl.textContent = best ?? 0;
    }

    function setSpeedFromScore() {
      const steps = Math.floor(score / SPEED_STEP);
      interval = Math.max(MIN_INTERVAL, BASE_INTERVAL - steps * 10);
      if (running) restartLoop();
    }

    function restartLoop() {
      stopLoop();
      timerId = setInterval(tick, interval);
    }
    function stopLoop() {
      if (timerId) clearInterval(timerId);
      timerId = null;
    }

    function startPause() {
      if (dead) return; // no iniciar si est√° muerto
      running = !running;
      if (running) {
        showOverlay(false);
        restartLoop();
      } else {
        stopLoop();
        showOverlay(true, 'Pausa', 'Presiona Iniciar o barra espaciadora');
      }
    }

    function gameOver() {
      dead = true;
      running = false;
      stopLoop();
      best = Math.max(best ?? 0, score);
      updateUI();
      showOverlay(true, 'Fin del juego', 'Presiona Reiniciar o tecla R');
    }

    function showOverlay(show, title = '', hint = '') {
      if (show) {
        overlay.classList.add('show');
        statusEl.textContent = title;
        hintEl.textContent = hint;
      } else {
        overlay.classList.remove('show');
      }
    }

    function placeFood() {
      // Genera una posici√≥n libre
      while (true) {
        const x = Math.floor(Math.random() * COLS);
        const y = Math.floor(Math.random() * ROWS);
        const onSnake = snake.some(s => s.x === x && s.y === y);
        if (!onSnake) { food = { x, y }; return; }
      }
    }

    function tick() {
      // Actualiza direcci√≥n (evita reversa inmediata)
      if (!isOpposite(nextDir, dir)) dir = { ...nextDir };

      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

      // Colisiones con paredes
      if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS) {
        gameOver(); draw(); return;
      }
      // Colisi√≥n con el cuerpo
      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        gameOver(); draw(); return;
      }

      snake.unshift(head);

      // Comer comida
      if (head.x === food.x && head.y === food.y) {
        score += 1;
        setSpeedFromScore();
        updateUI();
        placeFood();
      } else {
        snake.pop(); // avanza sin crecer
      }

      draw();
    }

    function isOpposite(a, b) {
      return a.x === -b.x && a.y === -b.y;
    }

    // ===== Render =====
    function draw() {
      // Limpia
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Comida
      drawFood(food.x, food.y);

      // Serpiente
      for (let i = snake.length - 1; i >= 0; i--) {
        const seg = snake[i];
        const t = i / Math.max(1, snake.length - 1);
        const color = lerpColor([73, 222, 128], [26, 180, 95], t); // degrade suave
        drawCell(seg.x, seg.y, color);
      }

      // Cabeza con borde
      const head = snake[0];
      drawCell(head.x, head.y, [255, 255, 255], true);
    }

    function drawCell(cx, cy, rgb = [73, 222, 128], strong = false) {
      const x = cx * TILE;
      const y = cy * TILE;
      ctx.fillStyle = `rgb(${rgb[0]},${rgb[1]},${rgb[2]})`;
      const pad = strong ? 2 : 3;
      ctx.fillRect(x + pad, y + pad, TILE - pad * 2, TILE - pad * 2);
      if (strong) {
        ctx.strokeStyle = 'rgba(255,255,255,0.25)';
        ctx.lineWidth = 1.5;
        ctx.strokeRect(x + 1.5, y + 1.5, TILE - 3, TILE - 3);
      }
    }

    function drawFood(cx, cy) {
      const x = cx * TILE + TILE / 2;
      const y = cy * TILE + TILE / 2;
      ctx.beginPath();
      ctx.arc(x, y, TILE * 0.33, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,93,93,0.95)';
      ctx.fill();
      ctx.closePath();
      // Destello
      ctx.beginPath();
      ctx.arc(x - 3, y - 3, TILE * 0.12, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.fill();
      ctx.closePath();
    }

    function lerpColor(a, b, t) {
      return [
        Math.round(a[0] + (b[0] - a[0]) * t),
        Math.round(a[1] + (b[1] - a[1]) * t),
        Math.round(a[2] + (b[2] - a[2]) * t),
      ];
    }

    // ===== Entradas =====
    function setDirectionFromKey(key) {
      const map = {
        ArrowUp:    { x: 0, y: -1 },
        ArrowDown:  { x: 0, y:  1 },
        ArrowLeft:  { x: -1, y: 0 },
        ArrowRight: { x: 1, y:  0 },
        w: { x: 0, y: -1 }, W: { x: 0, y: -1 },
        s: { x: 0, y:  1 }, S: { x: 0, y:  1 },
        a: { x: -1, y: 0 }, A: { x: -1, y: 0 },
        d: { x: 1, y: 0 },  D: { x: 1, y: 0 },
      };
      const nd = map[key];
      if (!nd) return;
      // Evita reversa inmediata
      if (snake.length > 1 && nd.x === -dir.x && nd.y === -dir.y) return;
      nextDir = nd;
    }

    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        startPause();
        return;
      }
      if (e.key === 'r' || e.key === 'R') {
        e.preventDefault();
        resetGame();
        return;
      }
      setDirectionFromKey(e.key);
    }, { passive: false });

    // Botones UI
    btnStart.addEventListener('click', startPause);
    btnReset.addEventListener('click', resetGame);
    btnResume.addEventListener('click', startPause);

    // Controles t√°ctiles
    document.querySelectorAll('.touch button[data-dir]').forEach(btn => {
      btn.addEventListener('click', () => {
        const d = btn.getAttribute('data-dir');
        const map = {
          up:    { x: 0, y: -1 },
          down:  { x: 0, y:  1 },
          left:  { x: -1, y: 0 },
          right: { x: 1, y:  0 },
        };
        const nd = map[d];
        if (snake.length > 1 && nd.x === -dir.x && nd.y === -dir.y) return;
        nextDir = nd;
      });
    });

    // ===== Inicio =====
    try {
      best = Number(localStorage.getItem('bestSnakeScore')) || 0;
    } catch { best = 0; }
    resetGame();

    // Guarda mejor puntaje al salir
    window.addEventListener('beforeunload', () => {
      try { localStorage.setItem('bestSnakeScore', String(best ?? 0)); } catch {}
    });
  </script>
</body>
</html>